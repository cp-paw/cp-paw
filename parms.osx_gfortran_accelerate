################################################################################
##                                                                            ##
##  parameter file for configuration of PAW environment                       ##
##     "configure --with-parmfile=...."                                       ##
##                                                                            ##
##    compile: $COMPILER $FCLAGS -o object source                             ##
##    link:    $COMPILER $LDFLAGS -o executable objects $LIBS                 ##
##                                                                            ##
## LDFLAGS Options for the linker. should contain options like -s and -L      ##
##         that affect only the behavior of the linker                        ##
## FCFLAGS Debugging and optimization options for the fortran compiler.       ##
## CPFLAGS Options for the C-preprocessor CPP. countain options like -I -D    ##
##         and -U that affect which parts of the code will be selected        ##
## LIBS    -l options passed to the linker.                                   ##
##                                                                            ##
##  ${OBJDIR} is bin/${ARCH}/Objects/${TYPE} rel. to the main PAW directory   ##
##         and where ${TYPE} is either "none", "none_parallel", "fast",       ##
##         "fast_parallel", etc.                                              ##
##                                                                            ##
##  Required:                                                                 ##
##    ${MPIDIR}/bin/mpifort                                                   ##
##    ${MPIDIR}/include/mpi_f08.mod (use mpi_f08 in src/paw_mpelib.f90)       ##
##    ${MPIDIR}/lib/libmpi.dylib                                              ##
##    ${FFTDIR}/include/fftw_f77.i (include fftw_f77.i in src/paw_library.f90)##
##    ${FFTDIR}/include/fftw.f03    (include fftw.f03 in src/paw_library.f90) ##
##    ${FFTDIR}/lib/libfftw3.dylib                                            ##
##    ${LIBXCDIR}/lib/libxcf03.dylib                                          ##
##                                                                            ##
##  MACOS AND HOMEBREW:                                                       ##
##    in the Apple environment I am using homebrew to install external        ##
##    libraries, such as blas, lapack, mpi, fftw3, libxc.                     ##
##    Blas and lapack need not be specified because they are included         ##
##    automatically when using the compiler flag -framework accellerate.      ##
##                                                                            ##
##    The libraries installed by homebrew (mpi, fftw, libxc) are in           ##
##       /opt/homebrew/lib.                                                   ##
##    Include and module files lie in /opt/homebrew/include .                 ##
##    The lib and include directories in opt/homebrew/ contain a list of      ##
##    of symbolic links pointing to the actual installation. Typically        ##
##      /opt/homebrew/lib/fftw.f03                                            ##
##           -> /opt/homebrew/Cellar/fftw/3.3.10_1/lib/fftw.f03.              ##
##     
##    MPI:  /opt/homebrew/Cellar/open-mpi/
##    FFTW3 /opt/homebrew/Cellar/fftw/
##    LIBXC /opt/homebrew/Cellar/libxc/
##     
##  PREPROCESSOR VARIABLES   
##    CPPVAR_BLAS_ESSL 
##    CPPVAR_FFT_ESSL
##    CPPVAR_FFT_FFTW
##    CPPVAR_FFT_FFTW3
##    CPPVAR_FFT_ACML
##    CPPVAR_FFT_PACK
##    CPPVAR_USAGE_EXIST
##    CPPVARIABLE_PARALLEL
##    CPPVAR_MPI2
##     
################################################################################
#
################################################################################
##                                                                            ##
##----------------------------------------------------------------------------##
##  ARCH: executables will be placed in bin/$ARCH.                            ##
##        recommended use: ARCH=operatingsystem_compilername_libraryname      ##
##----------------------------------------------------------------------------##
##  TPARALLEL: set to "T" to allow making parallel executables.               ##            
##             set to "F" if no MPI libraray available                        ##
##----------------------------------------------------------------------------##
##  SPECIAL : special rules for the configure script and f90 preprocessor     ##
##            use SPECIAL="none" if no special rules are used                 ##
##            other options                                                   ##
##              "IBM" : IBM environment is special (ESSL library,             ##
##               MPI automatically included, needs POE)                       ##
##___________________________DIRECTORIES containing LIBRARIES_________________##
##  leave empty if not needed.                                                ##
##    BLASDIR
##    LAPACKDIR
##    FFTDIR
##    MPIDIR
##----------------------------------------------------------------------------##
##  FFT_HEADER: include file for fftw
##              for FFTW version 1 and 2: ...fortran/fftw_f77.i       ##
##              for FFTW version 3, the file to include is ...fftw3.f         ##
##              (e.g. "/usr/local/Cellar/fftw/3.3.4_1/include/fftw3.f03")
##                                                                            ##
##----------------------------------------------------------------------------##
##  COMPILER_SCALAR  
##  COMPILER_PARALLEL
##               compiler call with all options that are identical for 
##               compilation and linking and that are independent of 
##               optimization, debugging profiling etc.                       ##
##               (e.g. "gfortran -fno-second-underscore ")                    ##
##               (e.g. "${MPIDIR}/bin/mpifort -fno-second-underscore ")       ##
##                                                                            ##
##               what is -mpitrace -show -mpilog?
##                                                                            ##
##------------------------compile flags---------------------------------------##
##   compile flags (as opposed to link flags)                                 ##
##     FCFLAGS_NONE    standard   (e.g. -c)
##     FCFLAGS_OPT     optimized  (e.g. -c -O3 etc)
##     FCFLAGS_PROF    profiling  (e.g. -c -pg etc)
##     FCFLAGS_DBG     debugging  (e.g. -c-g etc)
##                                                                            ##
##______________________________flags for linking_____________________________##
##     LDFLAGS_SCALAR link flags for sequential code
##     LDFLAGS_PARALLEL link flags for parallel code
##                                                                            ##
##----------------------------------------------------------------------------##
##  LIBS_SCALAR     external libraries (sequential)                           ##
##  LIBS_PARALLEL   external libraries (parallel)                             ##
##                                                                            ##
##  Remarks:                                                                  ##
##   -- g2c is a fortran-to-c compatibility library required by blas and lapack#
##                                                                            ##
##________________________________preprocessor variables______________________##
##                                                                            ##
##  library selectors for linear algebra routines                             ##
##    CPPVAR_LAPACK_ESSL:                                                     ##
##    CPPVAR_BLAS_ESSL                                                        ##
##                                                                            ##
##  library selectors for FFT                                                 ##
##    CPPVAR_FFT_ESSL                                                         ##
##    CPPVAR_FFT_FFTW                                                         ##
##    CPPVAR_FFT_FFTW3                                                        ##
##    CPPVAR_FFT_ACML                                                         ##
##    CPPVAR_FFT_PACK                                                         ##
##                                                                            ##
##  library selector for getrusage                                            ##
##    CPPVAR_USAGE_EXIST                                                      ##
##                                                                            ##
##   libraries for sparse matrix diagonalization for use in paw_bands tool    ##
##      CPPVAR_FFT_FFTW3 "
##      CPPVAR_FEAST
##      CPPVAR_JADAMILU
##      CPPVAR_SLEPC  (#INCLUDE <FINCLUDE/SLEPCEPSDEF.H>)                   
##________________________________file extension______________________________##
##  FEXT: file extensions for source files required by the compiler           ##
##  may be "f" or "f90"                                                       ##
##                                                                            ##
################################################################################
##  the link command for scalar executable will be:                           ##
##    "COMPILE LDFLAGS -I${OBJDIR} -L${OBJDIR} LLINK -oexecutable objects LLIB##
##  the link command for parallel executable will be:                         ##
##    "COMPILE LDFLAGS -I${OBJDIR} -L${OBJDIR} LLINK -L{MPIDIR} -oexecutable objects LLIBS"  ##
##  ${OBJDIR} is bin/${ARCH}/Objects/${TYPE} relative to the main PAW directory        ##
##   and where ${TYPE} is either "none", "none_parallel", "fast", "fast_parallel", etc.##
################################################################################
##  variables that may be defined in this parmfile
## ARCH
## TPARALLEL
## TUPPERCASEMOD
## COMPILER_SCALAR
## COMPILER_PARALLEL
## FCFLAGS_NONE
## FCFLAGS_OPT
## FCFLAGS_DBG
## FCFLAGS_PROF
## LDFLAGS_NONE
## LDFLAGS_OPT
## LDFLAGS_DBG
## LDFLAGS_PROF
## LDFLAGS_SCALAR
## LDFLAGS_PARALLEL
## LIBS_SCALAR
## LIBS_PARALLEL
## CPPFLAGS
## FEXT
## BLASDIR
## LAPACKDIR
## FFTDIR
## MPIDIR
## LIBXCDIR
## FFT_HEADER
## LIBAR




ARCH="osx_gfortran_accellerate"
TPARALLEL="T"
SPECIAL="none"
COMPILER_SCALAR="gfortran "
COMPILER_PARALLEL="${MPIDIR}/bin/mpifort "
BLASDIR=""
LAPACKDIR=""
FFTDIR="/opt/homebrew/"
FFT_HEADER="/opt/homebrew/include/fftw3.f03"
MPIDIR="/opt/homebrew/"
LIBXCDIR="/opt/homebrew/"
#
#
FCFLAGS_NONE="-c -I${FFTDIR}/include -I${LIBXCDIR}/include "
#
FCFLAGS_OPT="-c -I${FFTDIR}/include -I${LIBXCDIR}/include -O3  -funroll-loops -fomit-frame-pointer -march=native -fexternal-blas "
#
FCFLAGS_PROF="-c -I${FFTDIR}/include -I${LIBXCDIR}/include -pg -O3 -funroll-loops"
#
FCFLAGS_DBG="-c -I${FFTDIR}/include -I${LIBXCDIR}/include -g -O3 -funroll-loops -fomit-frame-pointer -march=native -std=f2008 -pedantic -fbacktrace -fdump-core -fimplicit-none -fcheck=bounds,do,mem,pointer,recursion -ffpe-trap=invalid,zero,overflow -ffpe-summary=invalid,zero,overflow -fexternal-blas -Wall -Wextra -Wline-truncation  -Wuninitialized -Wno-maybe-uninitialized"


#
# recommendation by http://fortranwiki.org/fortran/show/Debugging+tools
# -g -Wall -Wextra -Warray-temporaries -Wconversion -fimplicit-none -fbacktrace -ffree-line-length-0 -fcheck=all -ffpe-trap=zero,overflow,underflow -finit-real=nan
#
# gfortran -ffpe-trap=invalid: invAlid floating point operation such as sqrt(-1)
# gfortran -ffpe-trap=zero: catch division by zero
#
# gfortran : -finit-real=snan
# 
# -Wall= -Waliasing, -Wampersand, -Wconversion, -Wsurprising, ‘-Wc-binding-type’, ‘-Wintrinsics-std’, ‘-Wno-tabs’, ‘-Wintrinsic-shadow’, ‘-Wline-truncation’, ‘-Wtarget-lifetime’, ‘-Wreal-q-constant’ and ‘-Wunused’.
#
#

#
LDFLAGS_SCALAR="-I${OBJDIR} -L${OBJDIR} -framework Accelerate "
#
LDFLAGS_PARALLEL="-I${OBJDIR} -L${OBJDIR} -framework Accelerate "
#
LIBS_SCALAR="-L${FFTDIR}/lib -lfftw3 -L${LIBXCDIR}/lib -lxcf03"
#
LIBS_PARALLEL="-L${FFTDIR}/lib -lfftw3 -L${LIBXCDIR}/lib -lxcf03"
#
#  variables for the c-prepocessor:
#      CPPVAR_FFT_FFTW3 "
#      CPPVAR_FEAST
#      CPPVAR_JADAMILU
#      CPPVAR_SLEPC  (#INCLUDE <FINCLUDE/SLEPCEPSDEF.H>)
#
CPPFLAGS="-DCPPVAR_FFT_FFTW3 -DCPPVAR_NOLIBXC"
FEXT="f90"

